# 待实现功能清单

本文档记录游戏中需要实现但尚未完成的细节。

---

## 1. 物品合并逻辑 (handleItemCollision) ✅ 已完成

### 需要完成的内容：
- [ ] 标记为已合并，防止重复处理
- [ ] 计算合并后的位置（两者的中间点）
- [ ] 移除旧物品（从物理世界和items数组中删除）
- [ ] 创建新物品（等级+1）
- [ ] 添加合并分数（根据新等级的score）
- [ ] 更新最高等级
- [ ] 播放合并动画/特效

### 参考代码框架：
```javascript
function handleItemCollision(bodyA, bodyB) {
    if (bodyA.gameLevel === bodyB.gameLevel && 
        !bodyA.isMerged && !bodyB.isMerged &&
        bodyA.gameLevel < ACADEMIC_TITLES.length) {
        
        bodyA.isMerged = true;
        bodyB.isMerged = true;
        
        // 计算中间位置
        const midX = (bodyA.position.x + bodyB.position.x) / 2;
        const midY = (bodyA.position.y + bodyB.position.y) / 2;
        
        // 移除旧物品
        Composite.remove(engine.world, bodyA);
        Composite.remove(engine.world, bodyB);
        items = items.filter(item => item !== bodyA && item !== bodyB);
        
        // 创建新物品
        const newLevel = bodyA.gameLevel + 1;
        createMergedItem(midX, midY, newLevel);
        
        // 更新分数
        const title = ACADEMIC_TITLES[newLevel - 1];
        updateScore(title.score);
        
        // 更新最高Title
        updateHighestTitle(newLevel);
    }
}
```

---

## 2. 自定义渲染 - 在物品上显示图标/文字 ✅ 已完成

### 需要完成的内容：
- [ ] 禁用Matter.js默认渲染
- [ ] 在gameLoop中实现自定义渲染
- [ ] 在每个物品上绘制对应的学术Title图标和名称
- [ ] 添加发光/特效效果

### 建议方案：
使用Canvas 2D API进行自定义绘制：
```javascript
function customRender() {
    const ctx = render.context;
    // 遍历所有物品，绘制自定义内容
    items.forEach(item => {
        // 绘制圆形背景
        // 绘制图标
        // 绘制文字
    });
}
```

---

## 3. 游戏结束判定 ✅ 已完成

### 需要完成的内容：
- [ ] 监听物品是否堆积到顶部边界
- [ ] 设置合理的判定时间（物品稳定后才判定）
- [ ] 触发gameOver函数

### 建议实现：
在gameLoop中检查是否有物品超过顶部边界且处于静止状态。

---

## 4. 音效系统 ✅ 已完成

### 已实现：
- [x] 添加物品下落音效
- [x] 添加合并音效（不同等级有不同音效）
- [x] 添加游戏结束音效
- [x] 添加静音按钮
- [x] 使用Web Audio API合成音效（无需外部文件）

---

## 5. 动画和特效 ✅ 已完成

### 已实现：
- [x] 合并时的缩放动画
- [x] 合并时的发光效果（高等级更强）
- [x] 分数增加时的飘字动画
- [x] 物品生成时的出现动画（弹性放大）
- [x] 新Title解锁时的庆祝音效

---

## 6. 分数存储 ✅ 已完成

### 已实现：
- [x] 使用localStorage保存最高分
- [x] 页面刷新后恢复最高分
- [x] 添加历史最高分显示

---

## 7. 移动端优化 ✅ 已完成

### 需要完成的内容：
- [x] 触摸控制优化（更灵敏）
- [x] 防止页面滚动
- [x] 添加移动端启动画面
- [x] 适配各种屏幕尺寸

---

## 8. 游戏玩法优化 ✅ 已完成

### 需要完成的内容：
- [x] 添加"再来一次"快捷按钮
- [x] 添加游戏暂停功能
- [ ] 添加悔棋功能（可选）
- [ ] 添加道具系统（可选）

---

## 9. 视觉设计优化 ✅ 已完成

### 需要完成的内容：
- [ ] 设计更精美的物品图标（用AI生成或手绘）
- [x] 添加背景图案/渐变
- [x] 添加粒子特效
- [x] 添加连击提示

---

## 10. 发布和部署

### 需要完成的内容：
- [ ] 优化代码，移除调试日志
- [ ] 压缩静态资源
- [ ] 部署到Vercel/Netlify/Cloudflare Pages
- [ ] 绑定自定义域名

---

## 11. 游戏成瘾设计 (基于游戏心理学研究)

### 核心成瘾机制：
- [x] **进度反馈系统** - 实时显示当前等级、进度条、下一个目标
- [x] **连击倍数系统** - 连续合并增加分数倍数（2连击x1.5, 3连击x2.0）
- [x] **随机奖励机制** - 一定概率掉落双倍分数、减速道具
- [x] **成就系统** - 达成特定条件解锁成就（如：合并10次、获得博士称号等）
- [x] **里程碑提示** - 显示"距离XX成就还差X次"

### 心理激励设计：
- [x] **即时反馈** - 每次操作都有视觉/音效反馈
- [x] **损失厌恶** - "再来一局"按钮让玩家觉得"差一点就赢了"
- [x] **社交竞争** - 本地排行榜、最高分记录
- [x] **视觉爽感** - 合并时大数字飘字、屏幕震动、粒子爆发
- [x] **音效强化** - 连击时的音效变化、成就解锁音效

### 持续参与设计：
- [x] **每日任务** - 每日登录奖励、限时挑战
- [x] **无缝重启** - 失败后快速重新开始
- [x] **难度曲线** - 随分数增加逐步提升难度，即增加一个时间限制，超过时间限制就自动往下掉小球，分几个等级，分越高等级越高时间越少
- [x] **收藏要素** - 解锁不同学术Title的成就展示

---

## 12. 海克斯式随机增幅系统（参考英雄联盟海克斯大乱斗）

### 灵感来源
海克斯大乱斗的核心成瘾机制是"随机性增幅"——每局游戏随机获得不同增益，创造"每把都不一样"的新鲜感和期待感。

### 类似设计模式：

#### 12.1 随机Buff系统 ⭐
- [x] **每局随机3选1 Buff** - 游戏开始时从5-7个Buff中随机展示3个供玩家选择，也可以是等级升级时，跳出三个窗口选择
- [x] **触发式随机增益** - 合并时随机触发短期增益（如：接下来3次合并分数x2）
- [x] **随机天气/环境** - 每60秒随机切换一种环境状态

#### 12.2 掉落型随机奖励 ⭐
- [x] **消球随机掉落** - 每次合并有概率掉落金币/道具
- [x] **开宝箱机制** - 累计一定分数后开启宝箱，获得随机奖励
- [x] **神秘礼包** - 随机时间出现的神秘礼包，打开获得随机效果

#### 12.3 随机事件系统
- [x] **突发事件** - 随机触发特殊事件（如：所有球变大/变小、重力反转）
- [ ] **随机挑战** - 限时达成特定目标（如：10秒内合并3次）
- [x] **Boss出现** - 随机出现大球，吞噬后获得巨额分数

#### 12.4 随机难度修饰符
- [x] **每日特殊规则** - 每天随机1-2个游戏规则变化
- [ ] **局内随机变数** - 游戏过程中随机添加障碍物或加速带
- [ ] **随机对手AI** - 如果添加多人模式，每个对手有不同性格

#### 12.5 随机收藏要素
- [x] **图鉴收集** - 收集不同的"海克斯组合"
- [x] **成就解锁** - 达成特定Buff组合解锁成就
- [x] **运气统计** - 记录玩家每局的"运气值"

### Buff示例设计：

| Buff名称 | 效果 | 稀有度 |
|----------|------|--------|
| 学术爆发 | 接下来5次合并分数x2 | 常见 |
| 时间延缓 | 下落时间增加50% | 常见 |
| 合并加速 | 物品下落速度+30% | 常见 |
| 幸运星 | 消球时30%概率额外获得分数 | 少见 |
| 重力反转 | 3秒内所有物品向上飘 | 稀有 |
| 博士光环 | 场上所有物品等级+1 | 史诗 |
| 时间静止 | 5秒内时间暂停 | 传说 |

---

## 优先级排序

1. **高优先级**（核心玩法）
   - 物品合并逻辑
   - 自定义渲染
   - 游戏结束判定

2. **中优先级**（体验优化）
   - 音效系统
   - 动画特效
   - 移动端优化

3. **低优先级**（扩展功能）
   - 分数存储
   - 游戏玩法优化
   - 视觉设计
